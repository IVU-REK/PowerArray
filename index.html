<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Power Array Tests</title>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script src="https://raw.githubusercontent.com/detky/PowerArray/master/PowerArray.min.js" type="text/javascript"></script><script language="javascript">
        var quantity, elements, counter, duration, startTime;

        function createDummies(quantity) {
            var result = [];
            for (var i = 0; i < quantity; i++) {
                result.push({
                    Name: 'thename' + i,
                    id: i
                });
            }
            return result;
        }

        var func = function (element) {
            if (element.id % 100 === 0 )
            console.log('function called for element ' + element.id);
            element.newProperty = element.id * element.id;
        }

        function runTest(quantity, result) {
            var i, elements = createDummies(quantity), durationNormalLoop, durationPa;
            var elements2 = elements.slice(0);
            var result4normal = $('#' + result + 'normal');
            var result4pa = $('#' + result + 'pa');
            startTime = performance.now();
            for (i = 0; i < quantity; i++) {
                func(elements[i]);
            }

            durationNormalLoop = performance.now() - startTime;
            result4normal.html(durationNormalLoop.toFixed(4) + " ms.");

            startTime = performance.now();
            elements2.RunEachParalell(func, 15, function () {
                durationPa = performance.now() - startTime;
                result4pa.html(durationPa.toFixed(4) + " ms.");
                if (durationNormalLoop < durationPa) {
                    result4pa.css({ color: 'red' });
                    result4normal.css({ color: 'green' });
                } else {
                    result4pa.css({ color: 'green' });
                    result4normal.css({ color: 'red' });
                }
            });
        }

        function getSumarizationResult(elements) {
            
            var result = 0, x = elements.length;
            while (x--)
                result += elements[x].newProperty;

        }


        /*************************************************************************************/
        //var func = function () {
        //    counter++;
        //}

        //var startTime = performance.now();
        //for (i = 0; i < quantity; i++) {
        //    func(elements[i]);
        //}
        //duration = performance.now() - startTime;

        //startTime = performance.now();
        //elements.RunEachParalell(func, 4, function () {
        //    duration = performance.now() - startTime;
        //});

    </script>
    <style>
        #tblTests {
            text-align: center;
            width: 100%;
        }

            #tblTests tr td {
                vertical-align: top;
                padding: 3px;
            }

        #title {
            text-align: center;
            border-bottom: solid 2px black;
            padding: 25px;
        }

        textarea.code {
            font-family: monospace;
            font-size: 12px;
            width: 100% !important;
        }

        #selectQuantity {
        }
    </style>
</head>
<body>
    <div class="jumbotron" id="title">
        <h1>Power Array</h1>
        <h2>Speed Tests</h2>
        <!-- <p><a href="http://asp.net" class="btn btn-primary btn-large">Learn more &raquo;</a></p>-->
    </div>
    <div class="container-fluid">
        <table id="tblTests">
            <tr>
                <td width="34%" colspan="2"><label class="control-label" for="textarea">Function to execute</label></td>
                <td width="33%"><label class="control-label" for="textarea">Code Normal Loop</label></td>
                <td width="33%"><label class="control-label" for="textarea">Power Array</label></td>
            </tr>

            <tr>
                <td width="15%"><label class="control-label" for="textarea">1000 Repetitions</label></td>
                <td><button type="button" class="btn btn-primary" onclick="runTest(1000, 'result1000')">Run</button></td>
                <td id="result1000normal"></td>
                <td id="result1000pa"></td>
            </tr>

            <tr>
                <td width="15%"><label class="control-label" for="textarea">10000 Repetitions</label></td>
                <td><button type="button" class="btn btn-primary" onclick="runTest(10000, 'result10000')">Run</button></td>
                <td id="result10000normal"></td>
                <td id="result10000pa"></td>
            </tr>
            <tr>
                <td width="15%"><label class="control-label" for="textarea">100000 Repetitions</label></td>
                <td width="15%"><button type="button" class="btn btn-primary" onclick="runTest(100000, 'result100000')">Run</button></td>
                <td id="result100000normal"></td>
                <td id="result100000pa"></td>
            </tr>
            <tr>
                <td><label class="control-label" for="textarea">1000000 Repetitions</label></td>
                <td><button type="button" class="btn btn-primary" onclick="runTest(1000000, 'result1000000')">Run</button></td>
                <td id="result1000000normal"></td>
                <td id="result1000000pa"></td>
            </tr>
        </table>
        <!--<form class="form-horizontal">
            <fieldset>-->
        <!-- Text input-->
        <!--<div class="form-group">
                <label class="col-md-4 control-label" for="textinput">Text Input</label>
                <div class="col-md-4">
                    <input name="textinput" class="form-control input-md" id="textinput" type="text" placeholder="placeholder">
                    <span class="help-block">help</span>
                </div>
            </div>-->
        <!-- Textarea -->
        <!--<div class="form-group">
                            <label class="col-md-4 control-label" for="textarea">Function to execute</label>
                            <div class="col-md-4">
                                <textarea name="textarea" class="form-control" id="textarea" style="text-align: left;width:300px;height:200px;">
        var func2 = function () {
            counterParalell++;
        }
                                    </textarea>
                            </div>
                        </div>

                    </fieldset>
                    </form>-->

    </div>
</body>
</html>